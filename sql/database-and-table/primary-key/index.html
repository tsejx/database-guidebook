<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/database-guidebook/umi.3dfdd0be.css" />
    <script>
      window.routerBase = "/database-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>主键 - Database Guidebook</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/sql/database-and-table/primary-key" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/database-guidebook.png&#x27;)" href="/database-guidebook//">Database Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/database-guidebook//basic">基础</a></span><span><a aria-current="page" class="active" href="/database-guidebook//sql">SQL</a></span><span><a href="/database-guidebook//mongodb">MongoDB</a></span><span><a href="/database-guidebook//redis">Radis</a></span><span><a href="/database-guidebook//extensions">扩展</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/database-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/database-guidebook.png&#x27;)" href="/database-guidebook//"></a><h1>Database Guidebook</h1><p>Database 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/database-guidebook//basic">基础</a></li><li><a aria-current="page" class="active" href="/database-guidebook//sql">SQL</a></li><li><a href="/database-guidebook//mongodb">MongoDB</a></li><li><a href="/database-guidebook//redis">Radis</a></li><li><a href="/database-guidebook//extensions">扩展</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/database-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">概览</a><ul><li><a href="/database-guidebook//sql/overview/overview"><span>概述</span></a></li><li><a href="/database-guidebook//sql/overview/installation"><span>安装</span></a></li><li><a href="/database-guidebook//sql/overview/connection"><span>连接</span></a></li><li><a href="/database-guidebook//sql/overview/configuration"><span>配置</span></a></li><li><a href="/database-guidebook//sql/overview/grant"><span>权限管理</span></a></li><li><a href="/database-guidebook//sql/overview/log-system"><span>日志系统</span></a></li><li><a href="/database-guidebook//sql/overview/gui"><span>图形化工具</span></a></li><li><a href="/database-guidebook//sql/overview/command-line"><span>命令行</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">数据库和表</a><ul><li><a href="/database-guidebook//sql/database-and-table/create-database"><span>创建数据库</span></a></li><li><a href="/database-guidebook//sql/database-and-table/drop-database"><span>删除数据库</span></a></li><li><a href="/database-guidebook//sql/database-and-table/use-database"><span>选择数据库</span></a></li><li><a href="/database-guidebook//sql/database-and-table/create-table"><span>创建表</span></a></li><li><a href="/database-guidebook//sql/database-and-table/alter-table"><span>修改表</span></a></li><li><a href="/database-guidebook//sql/database-and-table/drop-table"><span>删除表</span></a></li><li><a href="/database-guidebook//sql/database-and-table/rename-table"><span>重命名表</span></a></li><li><a href="/database-guidebook//sql/database-and-table/truncate-table"><span>清空表</span></a></li><li><a aria-current="page" class="active" href="/database-guidebook//sql/database-and-table/primary-key"><span>主键</span></a></li><li><a href="/database-guidebook//sql/database-and-table/foreign-key"><span>外键</span></a></li><li><a href="/database-guidebook//sql/database-and-table/add-column"><span>添加列</span></a></li><li><a href="/database-guidebook//sql/database-and-table/drop-column"><span>删除列</span></a></li><li><a href="/database-guidebook//sql/database-and-table/auto-increment"><span>自增列</span></a></li><li><a href="/database-guidebook//sql/database-and-table/generated-columns"><span>生成列</span></a></li><li><a href="/database-guidebook//sql/database-and-table/unique-key"><span>唯一列</span></a></li><li><a href="/database-guidebook//sql/database-and-table/not-null"><span>NOT NULL</span></a></li><li><a href="/database-guidebook//sql/database-and-table/check-constraint"><span>CHECK 约束</span></a></li><li><a href="/database-guidebook//sql/database-and-table/locking-table"><span>锁表</span></a></li><li><a href="/database-guidebook//sql/database-and-table/character-set"><span>字符集和排序规则</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">基础语法</a><ul><li><a href="/database-guidebook//sql/basic/data-types"><span>数据类型</span></a></li><li><a href="/database-guidebook//sql/basic/select"><span>检索数据</span></a></li><li><a href="/database-guidebook//sql/basic/group-by"><span>分组数据</span></a></li><li><a href="/database-guidebook//sql/basic/order-by"><span>排序数据</span></a></li><li><a href="/database-guidebook//sql/basic/where"><span>过滤数据</span></a></li><li><a href="/database-guidebook//sql/basic/join"><span>连接表</span></a></li><li><a href="/database-guidebook//sql/basic/subquery"><span>子查询</span></a></li><li><a href="/database-guidebook//sql/basic/union"><span>集合运算</span></a></li><li><a href="/database-guidebook//sql/basic/function-aggregation"><span>聚合函数</span></a></li><li><a href="/database-guidebook//sql/basic/function-math"><span>算术函数</span></a></li><li><a href="/database-guidebook//sql/basic/function-string"><span>字符串函数</span></a></li><li><a href="/database-guidebook//sql/basic/function-date"><span>日期函数</span></a></li><li><a href="/database-guidebook//sql/basic/function-advanced"><span>其他函数</span></a></li><li><a href="/database-guidebook//sql/basic/insert"><span>插入数据</span></a></li><li><a href="/database-guidebook//sql/basic/modify"><span>更新和删除数据</span></a></li><li><a href="/database-guidebook//sql/basic/computed-field"><span>计算字段</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">高阶用法</a><ul><li><a href="/database-guidebook//sql/advanced/storage-engine"><span>存储引擎</span></a></li><li><a href="/database-guidebook//sql/advanced/transition"><span>数据库事务</span></a></li><li><a href="/database-guidebook//sql/advanced/cluster"><span>集群方案</span></a></li><li><a href="/database-guidebook//sql/advanced/index-performance"><span>索引优化与设计</span></a></li></ul></li><li><a href="/database-guidebook//sql/faq">FAQ</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="特性" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#特性"><span>特性</span></a></li><li title="主键类型" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#主键类型"><span>主键类型</span></a></li><li title="创建主键" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#创建主键"><span>创建主键</span></a></li><li title="在表创建时定义主键" data-depth="3"><a href="/database-guidebook//sql/database-and-table/primary-key#在表创建时定义主键"><span>在表创建时定义主键</span></a></li><li title="在表创建后添加主键" data-depth="3"><a href="/database-guidebook//sql/database-and-table/primary-key#在表创建后添加主键"><span>在表创建后添加主键</span></a></li><li title="删除主键" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#删除主键"><span>删除主键</span></a></li><li title="修改主键" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#修改主键"><span>修改主键</span></a></li><li title="自增主键" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#自增主键"><span>自增主键</span></a></li><li title="创建自增主键" data-depth="3"><a href="/database-guidebook//sql/database-and-table/primary-key#创建自增主键"><span>创建自增主键</span></a></li><li title="注意事项" data-depth="2"><a href="/database-guidebook//sql/database-and-table/primary-key#注意事项"><span>注意事项</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#主键"><span class="icon icon-link"></span></a>主键</h1><p>主键（Primary Key）是一种用于唯一标识表中每一行数据的特殊列或一组列。主键的作用是确保表中的每一行都有一个唯一标识符，这样可以方便地对表中的数据进行检索、更新和删除操作，同时保证数据的完整性和一致性。</p><h2 id="特性"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#特性"><span class="icon icon-link"></span></a>特性</h2><p>以下是主键的一些关键特点：</p><ul><li>唯一性：主键列中的值<strong>必须是唯一</strong>的，即每个主键值<strong>只能在表中出现一次</strong>。这确保了表中的<strong>每一行都有一个唯一的标识符</strong>。</li><li>非空性：主键列<strong>不允许包含空值（NULL）</strong>。这意味着主键列中的值不能为空，确保了<strong>每一行都有一个有效的标识符</strong>。</li><li>自动索引：主键列<strong>默认情况下会创建索引</strong>（称为主键索引），这使得在主键上的查找操作非常高效。通过主键索引，数据库系统可以快速定位表中特定行的数据，提高了查询性能。</li></ul><p>如果不遵循上面的规则，则可能会引发以下的错误。</p><ul><li>如果定义了多个主键，会返回错误：<code>ERROR 1068 (42000): Multiple primary key defined</code>。</li><li>如果插入或者更新时有重复的主键值，则会返回类似的错误：<code>ERROR 1062 (23000): Duplicate entry &#x27;1&#x27; for key &#x27;user.PRIMARY&#x27;</code>。</li><li>如果插入了 NULL 值，则会返回类似的错误：<code>ERROR 1048 (23000): Column &#x27;id&#x27; cannot be null</code>。</li></ul><h2 id="主键类型"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#主键类型"><span class="icon icon-link"></span></a>主键类型</h2><ul><li>单列主键：只由一个字段组成的主键。</li><li>复合主键：由两个或多个字段组成的主键，用于当单个字段无法保证唯一性时。</li></ul><h2 id="创建主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#创建主键"><span class="icon icon-link"></span></a>创建主键</h2><p>当创建主键时，你可以在创建表的时候定义它，或者在表已经存在之后添加主键。下面我将详细解释这两种情况，并提供相应的 SQL 示例代码。</p><h3 id="在表创建时定义主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#在表创建时定义主键"><span class="icon icon-link"></span></a>在表创建时定义主键</h3><h4 id="创建单列主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#创建单列主键"><span class="icon icon-link"></span></a>创建单列主键</h4><p>假设我们要创建一个包含用户信息的表，其中 <code>user_id</code> 是唯一标识每个用户的字段，我们可以将它设置为主键：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    user_id </span><span class="token keyword">INT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    username </span><span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    email </span><span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user_id</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在这个例子中，<code>user_id</code> 被定义为主键，同时设置为 <code>AUTO_INCREMENT</code>，这意味着每当插入新记录时，MySQL 会自动为 <code>user_id</code> 生成一个唯一的递增值。</p><h4 id="创建复合主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#创建复合主键"><span class="icon icon-link"></span></a>创建复合主键</h4><p>假设我们有一个记录书籍借阅信息的表，需要通过组合 user_id 和 book_id 来唯一标识每条借阅记录，我们可以创建一个复合主键：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> book_loans </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    user_id </span><span class="token keyword">INT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    book_id </span><span class="token keyword">INT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    loan_date </span><span class="token keyword">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    return_date </span><span class="token keyword">DATE</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user_id</span><span class="token punctuation">,</span><span class="token plain"> book_id</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在这个例子中，<code>user_id</code> 和 <code>book_id</code> 一起作为复合主键，这样就能保证同一本书不会被同一个用户重复借阅。</p><h3 id="在表创建后添加主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#在表创建后添加主键"><span class="icon icon-link"></span></a>在表创建后添加主键</h3><p>如果表已经被创建，但是没有定义主键，你可以使用 ALTER TABLE 语句来添加一个新的主键。这对于已经存在的表结构调整尤其有用。</p><h4 id="添加单列主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#添加单列主键"><span class="icon icon-link"></span></a>添加单列主键</h4><p>假设我们已经创建了一个用户表，但是忘记设置主键，现在我们想要把 <code>user_id</code> 字段设置为主键：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token keyword">ADD</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>这条语句会将 <code>user_id</code> 设置为主键。</p><h4 id="添加复合主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#添加复合主键"><span class="icon icon-link"></span></a>添加复合主键</h4><p>如果我们需要在现有的表上创建一个复合主键，可以通过指定多个列来完成：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> book_loans </span><span class="token keyword">ADD</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user_id</span><span class="token punctuation">,</span><span class="token plain"> book_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>这条语句将 <code>user_id</code> 和 <code>book_id</code> 作为一组复合主键，确保了每条借阅记录的唯一性。</p><p>通过这些示例，你应该对如何在 MySQL 中创建和管理主键有了基本的了解。主键是数据库设计中非常重要的一部分，正确使用它们可以确保数据的完整性和效率。</p><h2 id="删除主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#删除主键"><span class="icon icon-link"></span></a>删除主键</h2><p>在某些情况下，你可能需要删除一个表的主键约束，比如在重新设计表结构或调整数据模型时。使用 <code>ALTER TABLE</code> 语句可以实现这一点。</p><p>示例：删除主键</p><p>假设我们有一个 <code>users</code> 表，现在需要删除 <code>user_id</code> 字段上的主键约束。可以使用以下 SQL 语句：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token keyword">DROP</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">;</span></div></pre></div><p>这条语句会从 <code>users</code> 表中删除当前的主键约束。需要注意的是，如果主键是自增 (AUTO_INCREMENT) 的，删除主键也会移除自增属性，你可能需要再次手动设置它。</p><h2 id="修改主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#修改主键"><span class="icon icon-link"></span></a>修改主键</h2><p>修改主键实质上包含了<strong>删除现有主键</strong>和<strong>创建新主键</strong>两个步骤。由于 MySQL 不支持直接修改主键，你需要先删除现有的主键，然后再添加一个新的主键。</p><p>示例：修改单列主键</p><p>如果我们想要将 <code>users</code> 表的主键从 <code>user_id</code> 改为 <code>email</code>，可以通过以下步骤实现：</p><p>删除现有的主键：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token keyword">DROP</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">;</span></div></pre></div><p>添加新的主键：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token keyword">ADD</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在执行这些操作之前，确保新的主键列（在这个例子中是 email）满足主键的所有条件，即它们必须是唯一的且不包含 NULL 值。</p><p>示例：修改复合主键</p><p>假设 <code>book_loans</code> 表有一个复合主键，由 <code>user_id</code> 和 <code>book_id</code> 组成，现在我们需要添加一个 <code>loan_date</code> 字段到这个复合主键中，可以采用以下步骤：</p><p>删除现有的复合主键：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> book_loans </span><span class="token keyword">DROP</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token punctuation">;</span></div></pre></div><p>添加新的复合主键，包含额外的字段：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> book_loans </span><span class="token keyword">ADD</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user_id</span><span class="token punctuation">,</span><span class="token plain"> book_id</span><span class="token punctuation">,</span><span class="token plain"> loan_date</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>这种方式可以让你根据业务需求或数据模型的变化调整主键。</p><p>在进行主键修改操作时，特别注意数据的一致性和完整性。确保在删除和添加主键操作之间，表中的数据满足新主键的约束条件。此外，这些操作可能会影响到依赖于原主键的外键关系，因此在执行之前需要进行彻底的规划和测试。</p><h2 id="自增主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#自增主键"><span class="icon icon-link"></span></a>自增主键</h2><p>自增主键是数据库中一种常用的技术，特别是在需要自动为每条记录生成唯一标识符的场景中。在 MySQL 中，自增主键允许你在插入新记录时自动生成一个唯一的数字标识符。这里，我会详细讲解自增主键的概念、如何创建它们，以及使用时的一些注意事项。</p><h3 id="创建自增主键"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#创建自增主键"><span class="icon icon-link"></span></a>创建自增主键</h3><p><strong>在表创建时定义自增主键</strong></p><p>在创建表时，可以直接将某个字段指定为自增主键。通常，这个字段是表的第一个字段，并被定义为整型（如 INT 或 BIGINT）。</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    user_id </span><span class="token keyword">INT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    username </span><span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    email </span><span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user_id</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在这个例子中，<code>user_id</code> 被设置为自增主键。这意味着每当执行插入操作而没有指定 <code>user_id</code> 的值时，MySQL 会自动为这个字段分配下一个可用的数字。</p><p><strong>在表创建后添加自增主键</strong></p><p>如果表已经存在，你可以通过修改表结构来将某个字段设置为自增。首先，确保该字段是表的主键或者至少是一个唯一索引的一部分。</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> users </span><span class="token keyword">MODIFY</span><span class="token plain"> user_id </span><span class="token keyword">INT</span><span class="token plain"> </span><span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span></div></pre></div><p>这条语句将 <code>user_id</code> 修改为自增属性，前提是 <code>user_id</code> 已经是主键或唯一索引的一部分。</p><h2 id="注意事项"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//sql/database-and-table/primary-key#注意事项"><span class="icon icon-link"></span></a>注意事项</h2><p>在使用主键时，确保数据的一致性、完整性和性能是非常关键的。以下是使用主键时需要特别注意的一些事项：</p><ul><li>选择合适的主键<ul><li>唯一性：主键必须保证对于表中的每条记录都是唯一的。这是最基本也是最重要的规则。</li><li>简洁性：尽可能选择较短的主键。这有助于提高数据库的性能，因为它减少了索引的大小和维护索引的成本。</li><li>不变性：主键一旦为一条记录分配，就不应该更改。选择那些不会随时间改变的列作为主键。</li><li>连续性：虽然并非绝对必要，但使用自增主键可以保证新记录总是有一个连续增加的唯一标识符，这可以在某些情况下提高性能。</li></ul></li><li>避免使用外部数据作为主键<ul><li>尽量不要使用有实际意义的数据（如社会保障号码、员工编号等）作为主键，因为这些数据可能会因为业务规则的变化而发生变动。</li></ul></li><li>考虑使用自增主键<ul><li>对于很多应用场景，使用自增整数作为主键是一个简单且有效的选择，它能确保每条记录的唯一性，并且插入速度快。</li></ul></li><li>小心处理复合主键<ul><li>当单个字段无法保证唯一性时，可能会使用到复合主键。在使用复合主键时，需要特别注意它们的组合是否真的能够保证每条记录的唯一性，并考虑到查询和维护复合主键可能带来的额外复杂性。</li></ul></li><li>主键与性能<ul><li>主键的选择和设计会直接影响到数据库的查询和插入性能。一个良好设计的主键会使索引更高效，进而加速查询和插入操作。</li><li>考虑到索引大小，选择较小的数据类型作为主键，如 INT 而不是 BIGINT，可以在不牺牲功能的情况下提升性能。</li></ul></li><li>处理主键的变更<ul><li>修改主键是一项风险较高的操作，可能会影响到依赖该主键的外键关系。在修改主键前，需要进行彻底的规划和测试，确保不会破坏数据的完整性。</li></ul></li><li>避免依赖默认值<ul><li>在设计数据库时，避免让主键列依赖于数据库的默认值设置（除非是自增主键），应明确指定每条记录的主键值，以确保数据的清晰和一致性。</li><li>通过遵循这些准则，你可以确保数据库设计的健壮性和高效性，同时避免将来可能出现的问题。主键是数据库设计中的基石，正确处理它们对于保持数据完整性和提高性能至关重要。</li></ul></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/database-guidebook/edit/master/docs/sql/database-and-table/primary-key.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">3/25/2024 17:04:59</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/database-guidebook/umi.c9640e27.js"></script>
  </body>
</html>
