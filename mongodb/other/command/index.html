<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/database-guidebook/umi.3dfdd0be.css" />
    <script>
      window.routerBase = "/database-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>命令大全 - Database Guidebook</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/mongodb/other/command" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/database-guidebook.png&#x27;)" href="/database-guidebook//">Database Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/database-guidebook//basic">基础</a></span><span><a href="/database-guidebook//sql">SQL</a></span><span><a aria-current="page" class="active" href="/database-guidebook//mongodb">MongoDB</a></span><span><a href="/database-guidebook//redis">Radis</a></span><span><a href="/database-guidebook//extensions">扩展</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/database-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/database-guidebook.png&#x27;)" href="/database-guidebook//"></a><h1>Database Guidebook</h1><p>Database 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/database-guidebook//basic">基础</a></li><li><a href="/database-guidebook//sql">SQL</a></li><li><a aria-current="page" class="active" href="/database-guidebook//mongodb">MongoDB</a></li><li><a href="/database-guidebook//redis">Radis</a></li><li><a href="/database-guidebook//extensions">扩展</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/database-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">基本概述</a><ul><li><a href="/database-guidebook//mongodb/overview/basic"><span>基本概述</span></a></li><li><a href="/database-guidebook//mongodb/overview/installment"><span>安裝使用</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">高阶应用</a><ul><li><a href="/database-guidebook//mongodb/advanced/authentication"><span>鉴权</span></a></li><li><a href="/database-guidebook//mongodb/advanced/backup-and-recovery"><span>备份与恢复</span></a></li><li><a href="/database-guidebook//mongodb/advanced/replication"><span>数据库副本集</span></a></li><li><a href="/database-guidebook//mongodb/advanced/security"><span>数据库安全</span></a></li><li><a href="/database-guidebook//mongodb/advanced/sharding"><span>数据库分片</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">Mongoose</a><ul><li><a href="/database-guidebook//mongodb/mongoose/overview"><span>概述</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/connections"><span>连接 Connections</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/schema-types"><span>模式类型 SchemaTypes</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/model-api"><span>Model</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/queries"><span>普通查询</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/populate"><span>填充查询</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/aggregate"><span>聚合查询</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/hooks"><span>钩子函数</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/middleware"><span>中间件 Middleware</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/plugins"><span>插件</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/validation"><span>验证</span></a></li><li><a href="/database-guidebook//mongodb/mongoose/basic"><span>集成</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">基本操作</a><ul><li><a href="/database-guidebook//mongodb/basic/documents"><span>文档 Documents</span></a></li><li><a aria-current="page" class="active" href="/database-guidebook//mongodb/other/command"><span>命令大全</span></a></li><li><a href="/database-guidebook//mongodb/basic/models"><span>模型 Models</span></a></li><li><a href="/database-guidebook//mongodb/other/utils"><span>工具大全</span></a></li><li><a href="/database-guidebook//mongodb/basic/schemas"><span>模式 Schema</span></a></li><li><a href="/database-guidebook//mongodb/basic/indexes"><span>数据库索引</span></a></li><li><a href="/database-guidebook//mongodb/basic/models-relationship"><span>数据模型关联</span></a></li><li><a href="/database-guidebook//mongodb/basic/aggregation"><span>聚合管道</span></a></li><li><a href="/database-guidebook//mongodb/basic/subdocuments"><span>子文档 Subdocuments</span></a></li><li><a href="/database-guidebook//mongodb/other/mongodb"><span>扩展资料</span></a></li></ul></li><li><a href="/database-guidebook//mongodb/overview">基本概述</a><ul><li><a href="/database-guidebook//mongodb/overview/administration"><span>数据库管理</span></a></li><li><a href="/database-guidebook//mongodb/overview/configuration"><span>配置文件</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="数据库" data-depth="2"><a href="/database-guidebook//mongodb/other/command#数据库"><span>数据库</span></a></li><li title="查看数据库状态" data-depth="3"><a href="/database-guidebook//mongodb/other/command#查看数据库状态"><span>查看数据库状态</span></a></li><li title="删除信息" data-depth="2"><a href="/database-guidebook//mongodb/other/command#删除信息"><span>删除信息</span></a></li><li title="文档" data-depth="2"><a href="/database-guidebook//mongodb/other/command#文档"><span>文档</span></a></li><li title="创建文档" data-depth="3"><a href="/database-guidebook//mongodb/other/command#创建文档"><span>创建文档</span></a></li><li title="读取文档" data-depth="3"><a href="/database-guidebook//mongodb/other/command#读取文档"><span>读取文档</span></a></li><li title="更新文档" data-depth="3"><a href="/database-guidebook//mongodb/other/command#更新文档"><span>更新文档</span></a></li><li title="删除文档" data-depth="3"><a href="/database-guidebook//mongodb/other/command#删除文档"><span>删除文档</span></a></li><li title="拷贝文档" data-depth="3"><a href="/database-guidebook//mongodb/other/command#拷贝文档"><span>拷贝文档</span></a></li><li title="数据库服务" data-depth="2"><a href="/database-guidebook//mongodb/other/command#数据库服务"><span>数据库服务</span></a></li><li title="启动数据库" data-depth="2"><a href="/database-guidebook//mongodb/other/command#启动数据库"><span>启动数据库</span></a></li><li title="用户管理" data-depth="2"><a href="/database-guidebook//mongodb/other/command#用户管理"><span>用户管理</span></a></li><li title="导入导出" data-depth="2"><a href="/database-guidebook//mongodb/other/command#导入导出"><span>导入导出</span></a></li><li title="备份与恢复" data-depth="2"><a href="/database-guidebook//mongodb/other/command#备份与恢复"><span>备份与恢复</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="命令大全"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#命令大全"><span class="icon icon-link"></span></a>命令大全</h1><p>以下罗列使用 Mongo Shell 命令行对数据库的操作常用方法。</p><h2 id="数据库"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#数据库"><span class="icon icon-link"></span></a>数据库</h2><h3 id="查看数据库状态"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#查看数据库状态"><span class="icon icon-link"></span></a>查看数据库状态</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 显示当前数据库服务上的数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ show dbs</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 显示当前数据库的所有集合</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ show collections</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看当前数据库的用户信息</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ show </span><span class="token function">users</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 切换到指定的数据库进行操作</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ use </span><span class="token operator">&lt;</span><span class="token plain">db_name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看当前所在数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看数据库操作命令</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看集合操作命令，foo 是当前数据库下名为 foo 的集合名称</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.foo.help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看数据库状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.serverStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看数据库版本</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看数据库所在机器地址</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.getMongo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询指定数据库的统计信息</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ use admin</span></div><div class="token-line"><span class="token plain">$ db.stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></pre></div><h2 id="删除信息"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#删除信息"><span class="icon icon-link"></span></a>删除信息</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 删除数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.dropDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除用户</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.removeUser</span><span class="token punctuation">(</span><span class="token string">&#x27;userName&#x27;</span><span class="token punctuation">)</span></div></pre></div><h2 id="文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#文档"><span class="icon icon-link"></span></a>文档</h2><h3 id="创建文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#创建文档"><span class="icon icon-link"></span></a>创建文档</h3><p>创建文档的相关方法：</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.insert/">db.collection.insert()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.save/">db.collection.save()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/">db.collection.insertOne()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/">db.collection.insertMany()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h4 id="创建文档-1"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#创建文档-1"><span class="icon icon-link"></span></a>创建文档</h4><p>创建文档并插入集合中</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 不指定 _id 的新文档插入集合，会自动创建 ObjectId</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 指定 _id 的新文档插入集合</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p>创建多个文档并同时插入集合中</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insert</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">11</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">25</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>无序地创建多个文档，通过 <code>insert</code> 方法第二个参数的 <code>ordered</code> 为 <code>false</code> 创建。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insert</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">20</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">     </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">21</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">     </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">22</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token punctuation">]</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">   </span><span class="token punctuation">{</span><span class="token plain"> ordered: </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h4 id="创建单个文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#创建单个文档"><span class="icon icon-link"></span></a>创建单个文档</h4><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 基本使用方法</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 定义文档创建的安全写级别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insertOne</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> writeConcern: </span><span class="token punctuation">{</span><span class="token plain"> w: </span><span class="token string">&quot;majority&quot;</span><span class="token plain">, wtimeout: </span><span class="token number">100</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>返回结果中参数说明：</p><ul><li>acknowedged 安全写级别被启用</li><li>insertedId 写入文档的主键</li></ul><p>这里的 <code>writeConcern</code> 文档定义了本次文档创建操作的安全写级别。</p><p>简单来说，安全写级别用来判断一次数据库写入操作是否成功。</p><p>安全写级别越高，丢失数据的风险越低，然而写入操作的延迟也可能更高。</p><p>如果不提供 <code>writeConcern</code> 文档，MongoDB 使用<strong>默认</strong>的安全写级别。</p><h4 id="创建多个文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#创建多个文档"><span class="icon icon-link"></span></a>创建多个文档</h4><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 创建多个文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insertMany</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"> , </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># `ordered` 参数用来决定 MongoDB 是否要按顺序来写入这些文档。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 如果将 `ordered` 参数设置为 `false`，MongoDB 可以打乱文档写入的顺序，以便优化写入操作的性能。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.products.insertMany</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">10</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">11</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">11</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">12</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">13</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">13</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">14</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> ordered: </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>在顺序写入时，一旦遇到错误，操作便会退出，剩余的文档无论正确与否，都不会被写入。</p><p>在乱序写入时，即使某些文档造成了错误，剩余的正确文档仍然会被写入。</p><h3 id="读取文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#读取文档"><span class="icon icon-link"></span></a>读取文档</h3><ul><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.find/">db.collection.find()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.findAndModify/">db.collection.findAndModify()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.findOne/">db.collection.findOne()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.findOneAndDelete/">db.collection.findOneAndDelete()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.findOneAndReplace/">db.collection.findOneAndReplace()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.findOneAndUpdate/">db.collection.findOneAndUpdate()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p><strong>游标</strong></p><ul><li>查询操作返回的结果游标</li></ul><p><strong>投射</strong></p><ul><li>只返回部分字段</li><li>内嵌文档的投射</li><li>数组的投射</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 读取全部文档（既不筛选，也不投射）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 更清楚地查看文件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 匹配查询（例如读取字段 &lt;field&gt; 为 &lt;value&gt; 的文档）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&lt;&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 匹配查询（精确匹配多个字段）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h4 id="比较操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#比较操作符"><span class="icon icon-link"></span></a>比较操作符</h4><p>比较操作符（Comparison Query Operators）</p><p>⚠️ **注意：**文档后续示例中 <code>&lt;comparasion-operators&gt;</code> 表示比较操作符统称。</p><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th>比较操作符</th><th>说明</th></tr></thead><tbody><tr><td><code>$eq</code></td><td>匹配字段值相等的文档</td></tr><tr><td><code>$ne</code></td><td>匹配字段值不等的文档</td></tr><tr><td><code>$gt</code></td><td>匹配字段值大于查询值的文档</td></tr><tr><td><code>$gte</code></td><td>匹配字段值大于或等于查询值的文档</td></tr><tr><td><code>$lt</code></td><td>匹配字段值小于查询值的文档</td></tr><tr><td><code>$lte</code></td><td>匹配字段值小于或等于查询值的文档</td></tr></tbody></table></div></div><h5 id="eq"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#eq"><span class="icon icon-link"></span></a>$eq</h5><p>匹配严格相等值的文档</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查找 &lt;collection&gt; 集合中，字段 &lt;field&gt; 等于 &lt;value&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$eq</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 等价于</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p>根据内嵌文档的字段查询</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 被查询的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token operator">&lt;</span><span class="token plain">ObjectId</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">filed</span><span class="token operator file-descriptor important">5</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">5</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">valueN</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询内嵌文档字段 fiedl 的 field2 字段的值为 &lt;value&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p>查询数组成员</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 被查询的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询数组成员（所有文档中 &lt;field&gt; 字段数组中，包含 &quot;y&quot; 的数组成员就算匹配上）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询文档中数组类型字段 &lt;field&gt; 中，包含 &lt;value&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$eq</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h5 id="in"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#in"><span class="icon icon-link"></span></a>$in</h5><p>匹配字段值与任一查询值相等的文档</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># field 只要和查询语句数组中的任意一个 value（value1、value2 或 valueN）相同，那么该文档就会被检索出来</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$in</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">valueN</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 文档中 field1 字段数组中与任意一个 value 相同，那么就将该文档的 field2 字段更改为 value3</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$in</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h5 id="nin"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#nin"><span class="icon icon-link"></span></a>$nin</h5><p>匹配字段值与任何查询值都不等的文档</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询集合文档中字段 field 与任何 value（value1、value2 或 valueN）不想等的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$nin</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">valueN</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span></div></pre></div><h4 id="逻辑操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#逻辑操作符"><span class="icon icon-link"></span></a>逻辑操作符</h4><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th>操作符</th><th>说明</th></tr></thead><tbody><tr><td><code>$not</code>：</td><td>匹配筛选条件不成立的文档</td></tr><tr><td><code>$and</code>：</td><td>匹配多个筛选条件全部成立的文档</td></tr><tr><td><code>$or</code>：</td><td>匹配至少一个筛选条件成立的文档</td></tr><tr><td><code>$nor</code>：</td><td>匹配多个筛选条件全部不成立的文档</td></tr></tbody></table></div></div><h5 id="not"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#not"><span class="icon icon-link"></span></a>$not</h5><p>匹配筛选条件不成立的文档</p><p><strong>相斥</strong>表示与实际文档中相反的意思。例如：比较操作符使用 <code>$eq</code> 即，该语句表示 <strong>不想等</strong>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询集合文档中字段 &lt;field&gt; 与 &lt;value&gt; 相斥的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$not</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询集合文档中的嵌套文档 &lt;field1&gt; 的 &lt;field2&gt; 字段 与 &lt;value&gt; 相斥的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$not</span><span class="token builtin class-name">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h5 id="and"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#and"><span class="icon icon-link"></span></a>$and</h5><p>使用比较操作符时需要注意：</p><ul><li>如果比较的是数值类型，则按照大小排序</li><li>如果比较的是字符串等类型，则按照先后顺序</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询字段 &lt;field1&gt; 符合比较操作符的 &lt;value1&gt; 与字段 &lt;field2&gt; 符合比较操作符的 &lt;value2&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token variable">$and</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 简便写法</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 当筛选条件应用在同一个字段上时，也可以简化命令</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询字段 &lt;field&gt; 符合一个或多个比较操作符比较值后匹配的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h5 id="or"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#or"><span class="icon icon-link"></span></a>$or</h5><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$or</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token plain">expression</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token plain">expressions2</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token plain">expressionN</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询字段 field1 符合比较操作符比较 value1 后符合条件或字段 field2 符合比较操作符比较 value2 后符合条件的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token variable">$or</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 当 $or 操作符下使用的都是 $eq 时，可以直接使用 $in</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$in</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">valueN</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h5 id="nor"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#nor"><span class="icon icon-link"></span></a>$nor</h5><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 读取不属于 alice 和 charlie 且余额不少于 100 的银行账户文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询既不符合 `&lt;field1&gt;.&lt;field2&gt;` 比较条件，也不符合 &lt;field3&gt; 比较条件的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token variable">$nor</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h4 id="字段操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#字段操作符"><span class="icon icon-link"></span></a>字段操作符</h4><ul><li><code>$exists</code>：匹配包含查询字段的文档</li><li><code>$type</code>：匹配字段类型复合查询值的文档</li></ul><h5 id="exists"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#exists"><span class="icon icon-link"></span></a>$exists</h5><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"> field: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$exists</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">boolean</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询集合中存在内嵌文档 &lt;field1&gt; 的 &lt;field2&gt; 字段的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$exists</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询集合中存在内嵌文档 &lt;field1&gt; 的 &lt;field2&gt; 字段，并且该字段值符合比较操作符比较得到值的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token variable">$exists</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h5 id="type"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#type"><span class="icon icon-link"></span></a>$type</h5><p>匹配字段类型复合查询值的文档</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">{ field: { $type: &lt;BSON type&gt; } }</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">{ field: { $type: [&lt;BSON type1&gt;, &lt;BJSON type2&gt;, ...] } }</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询文档 _id 字段类型为 &lt;value&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$type</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 可以指定多种类型</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$type</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询字段 &lt;field&gt; 的值为 null 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$type</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;null&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span></div></pre></div><h4 id="数组操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#数组操作符"><span class="icon icon-link"></span></a>数组操作符</h4><ul><li><code>$all</code>：匹配数组字段中包含所有查询值的文档</li><li><code>$elemMatch</code>：匹配数组字段中至少存在一个值满足筛选条件的文档</li></ul><h5 id="all"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#all"><span class="icon icon-link"></span></a>$all</h5><p>这个操作符跟 SQL 语法的 in 类似，但不同的是, in 只需满足 <code>()</code> 内的某一个值即可, 而 <code>$all</code> 必须满足 <code>[]</code> 内的所有值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"> field: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$all</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">..</span><span class="token plain">.</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询集合中文档 &lt;field&gt; 字段（数组类型）并至少存在 $all 定义数组中所有值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$all</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span></div></pre></div><h5 id="elemmatch"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#elemmatch"><span class="icon icon-link"></span></a>$elemMatch</h5><p>匹配数组字段中至少存在一个值满足筛选条件的文档</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">queryN</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 读取联系电话范围在 1000 至 2000 之间的银行账户文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询集合中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token variable">$gt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">        </span><span class="token variable">$lt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 读取包含一个在 1000 至 2000之间，和一个 2000 至 3000 之间的联系电话的银行账户文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询集合中存在（大于）value1 至 （小于）value2，和一个（大于）value3 至（小于）value4 之间的 &lt;field&gt; 字段的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;all&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$gt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token variable">$lt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$gt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token variable">$lt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h4 id="正则表达式操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#正则表达式操作符"><span class="icon icon-link"></span></a>正则表达式操作符</h4><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 语法</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> /pattern/, </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;&lt;option&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> /pattern/</span><span class="token operator">&lt;</span><span class="token plain">options</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre></div><p>在和 <code>$in</code> 操作符一起使用时，智能使用 <code>/pattern/&lt;options&gt;</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询集合中文档字段 &lt;field&gt; 匹配正则 &lt;pattern1&gt; 或 &lt;pattern2&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$in</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">pattern</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">pattern</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询集合中文档字段 &lt;field&gt; 匹配正则 &lt;pattern&gt;，且符合配置项的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$regx</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">pattern</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token variable">$options</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;i&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">)</span></div></pre></div><h4 id="文档游标"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#文档游标"><span class="icon icon-link"></span></a>文档游标</h4><p>文档查询方法 <code>db.collection.find()</code> 会返回一个文档集合游标。</p><p>在不迭代游标的情况下，只会列出前 20 个文档。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">const myCursor </span><span class="token operator">=</span><span class="token plain"> db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>游历完游标中所有的文档之后，或者 10 分钟之后，游标便会自动关闭</p><p>可以使用 <code>noCursorTimeout()</code> 函数来保持游标一直有效</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">const cursor </span><span class="token operator">=</span><span class="token plain"> db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.noCursorTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">cursor.close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></div></pre></div><p>在这之后，在不遍历游标的情况下，你需要主动关闭游标。</p><p>其他游标函数：</p><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th>游标函数</th><th>说明</th></tr></thead><tbody><tr><td><code>cursor.hasNext()</code></td><td>游标指向还有剩余的文档，会返回 <code>true</code>，否则 <code>false</code></td></tr><tr><td><code>cursor.next()</code></td><td>游标文档集合的下一个文档</td></tr><tr><td><code>cursor.forEach()</code></td><td>对游标指向的每个文档遍历</td></tr><tr><td><code>cursor.limit(&lt;number&gt;)</code></td><td>只是返回指定数量的结果</td></tr><tr><td><code>cursor.skip(&lt;offset&gt;)</code></td><td>跳过指定数量文档</td></tr><tr><td><code>cursor.count(&lt;applySkopLimit&gt;)</code></td><td>集合文档的总量（默认忽略 <code>limit</code> 和 <code>skip</code>，除非 applySkipLimit 为 <code>true</code>）会从集合的元数据 Metadata 中取得结果，当数据库分布式结构较为复杂时，元数据中的文档数量不准确</td></tr><tr><td><code>cursor.sort(&lt;document&gt;)</code></td><td>排序，<code>&lt;document&gt;</code> 定义排序的要求，<code>1</code> 表示又小及大，<code>-1</code> 表示逆向排序</td></tr></tbody></table></div></div><p>⚠️ **注意：**游标函数方法执行顺序要准确</p><ul><li><code>skip</code> 必然在 <code>limit</code> 执行前执行。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 示例</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.limit</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token plain">.skip</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></div></pre></div><ul><li><code>sort</code> 必然在 <code>skip</code> 和 <code>limit</code> 之前执行</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 示例</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.skip</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token plain">.limit</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token plain">.sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">sort-number</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p><code>&lt;sort-number&gt;</code> 表示文档排序，用数值表示：</p><ul><li><code>0</code> 表示正序</li><li><code>1</code> 表示逆序</li></ul><p>当结合在一起使用时，游标函数的应用顺序是 <code>sort()</code>、<code>skip()</code> 再到 <code>limit()</code>。</p><h4 id="文档投影"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#文档投影"><span class="icon icon-link"></span></a>文档投影</h4><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">projection</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></div></pre></div><p>不实用投影时，<code>db.collection.find()</code> 返回复合筛选字段的完整文档。</p><p>而使用投影可以有选择性地返回文档中的部分字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 语法</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> field: inclusion </span><span class="token punctuation">}</span></div></pre></div><ul><li>1：表示返回字段</li><li>0：表示不返回字段</li></ul><p>🌰 <strong>示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询结果只返回 &lt;field&gt; 字段</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询结果只返回 &lt;field&gt; 字段（不包括文档主键）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, _id: </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询结果既不返回 &lt;field&gt; 字段，也不返回文档主键</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">0</span><span class="token plain">, _id: </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p>除了文档主键之外，我们不可以在投影文档中混合使用包含和不包含这两种投影操作。</p><p>要么在投影文档中列出所有应该包含的字段，要么列出所有不应该包含的字段。</p><p><strong>在数组字段上使用投影</strong></p><ul><li><code>$slice</code>：可以返回<strong>数组</strong>字段中的部分元素</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 只返回数组中的正向数第一个数组成员</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$slice</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 只返回数组中的倒向数第一个数组成员</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$slice</span><span class="token builtin class-name">:</span><span class="token plain"> -1 </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 只返回数组中的倒向数第二个数组成员</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$slice</span><span class="token builtin class-name">:</span><span class="token plain"> -2 </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 传数组，必然有两个成员，第一个 limit，第二个 skip</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$slice</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">1</span><span class="token plain">, </span><span class="token number">2</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p><code>$elemMatch</code> 和 <code>$</code> 操作符可以返回数组字段中满足筛选条件的第一个元素。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$gt</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h3 id="更新文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#更新文档"><span class="icon icon-link"></span></a>更新文档</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">update</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">options</span><span class="token operator">&gt;</span><span class="token punctuation">)</span></div></pre></div><ul><li><code>&lt;query&gt;</code>：文档定义了更新操作时筛选文档的条件，与 <code>find()</code> 参数 <code>&lt;query&gt;</code> 涵义相同</li><li><code>&lt;update&gt;</code>：提供了更新的内容</li><li><code>&lt;options&gt;</code>：声明一些更新操作的参数</li></ul><p>⚠️ **注意：**在更新文档的方法中 <code>&lt;query&gt;</code> 与查询文档的查询涵义相同，所以后续更新文档的示例第一个参数 <code>&lt;query&gt;</code> 直接以 <code>&lt;query&gt;</code> 表示。</p><h4 id="更新整篇文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#更新整篇文档"><span class="icon icon-link"></span></a>更新整篇文档</h4><p>如果 <code>&lt;update&gt;</code> 文档不包含任何更新操作符，<code>db.collection.update()</code> 将会使用 <code>&lt;update&gt;</code> 文档直接替换集合中符合 <code>&lt;query&gt;</code> 文档筛选条件的文档。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看集合中字段 &lt;field&gt; 的值为 &lt;value&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">object-id</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 将 alice 的账户余额更改为 123</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 将集合中字段 &lt;field1&gt; 的值为 &lt;value1&gt; 的文档中的 &lt;field2&gt; 的值该为 &lt;value2&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">WriteResult</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;nMatched&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">, </span><span class="token string">&quot;nUpserted&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">, </span><span class="token string">&quot;nModified&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># nMatched 匹配的文档数量</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># nModified 更改的文档数量</span></div></pre></div><p>⚠️ <strong>注意：</strong></p><ul><li>文档主键 <code>_id</code> 是不可以更改的</li><li>在使用 <code>&lt;update&gt;</code> 文档替换整篇被更新文档时，只有第一篇符合 <code>&lt;query&gt;</code> 文档筛选条件的文档会被更新</li></ul><h4 id="字段更新操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#字段更新操作符"><span class="icon icon-link"></span></a>字段更新操作符</h4><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th>操作符</th><th>说明</th></tr></thead><tbody><tr><td><code>$set</code></td><td>更新或新增字段</td></tr><tr><td><code>$unset</code></td><td>删除字段</td></tr><tr><td><code>$rename</code></td><td>重命名字段</td></tr><tr><td><code>$inc</code></td><td>加减字段值</td></tr><tr><td><code>$mul</code></td><td>相乘字段值</td></tr><tr><td><code>$min</code></td><td>比较减小字段值</td></tr><tr><td><code>$max</code></td><td>比较增大字段值</td></tr></tbody></table></div></div><h5 id="set"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#set"><span class="icon icon-link"></span></a>$set</h5><p>更新或新增字段</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询集合中文档字段 &lt;field&gt; 的值为 &lt;value&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain">.pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 在查询所得文档中，新增 &lt;field2&gt; 字段和 &lt;field3&gt; 内嵌文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>更新或新增内嵌文档的字段</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 更改查询所得文档中内嵌文档的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field2&gt;.&lt;field3&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>更新或新增数组内的字段</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 更改查询所得文档中数组类型字段 &lt;field2&gt; 指定索引 &lt;index&gt; 的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field2&gt;.&lt;index&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">:</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 添加 &lt;field2&gt;.&lt;index&gt; 的值 &lt;value2&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field2&gt;.&lt;index&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>如果向现有数组字段范围以外的位置添加新值，数组字段的长度会扩大，未被赋值的数组成员将被设置为 <code>null</code>。</p><p><strong>$unset</strong></p><p>删除字段</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$unset</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token string">&quot;&quot;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">. </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 删除查询所得文档中的 &lt;field1&gt; 字段和内嵌文档 &lt;field2&gt; 中的 &lt;field3&gt; 字段</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$unset</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field2&gt;.&lt;field3&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除查询所得文档中的 &lt;field1&gt; 数组字段中的索引为 &lt;index&gt; 的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$unset</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field1&gt;.&lt;index&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p><strong>$rename</strong></p><p>重命名字段</p><p>如果 <code>$rename</code> 命令要重命名的字段并不存在，那么文档内容不会被改变。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$rename</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>当 <code>$renmae</code> 命令中的新字段存在的时候，<code>$rename</code> 命令会先 <code>$unset</code> 新旧字段，然后再 <code>$set</code> 新字段。</p><p>重命名内嵌文档的字段</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 重命名查询所得文档的内嵌文档 &lt;field1&gt; 和数组字段 &lt;field4&gt; 索引为 &lt;index&gt; 的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$rename</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field4&gt;.&lt;index&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">fiedl</span><span class="token operator file-descriptor important">5</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">5</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">fiedl</span><span class="token operator file-descriptor important">6</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">6</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 重命名内嵌文档 &lt;field&gt; 字段 &lt;field2&gt; 的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 并将字段 &lt;field3&gt; 字段的值，改为 `&lt;value2&gt;.&lt;value3&gt;`</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$rename</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field3&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;&lt;value2&gt;.&lt;value3&gt;&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 数组内元素既不能内嵌文档字段拿到外部，也不能外部字段放到内部元素的内嵌文档中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$rename</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token string">&quot;&lt;field1&gt;.&lt;index&gt;.&lt;field2&gt;&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p><strong>$inc</strong> 和 <strong>$mul</strong></p><p>更新字段值，只适用于 Number 类型值。</p><ul><li><code>$inc</code>：增加</li><li><code>$mul</code>：乘以</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查询文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5bd446035b45a8e25a491832&quot;</span><span class="token punctuation">)</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 更改查询所得文档的的 &lt;field&gt; 字段值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;</span><span class="token string variable">$inc</span><span class="token string">&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 更新 David 的账户余额</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;</span><span class="token string variable">$mul</span><span class="token string">&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>如果被更新的字段不存在，<code>$inc</code> 会创建字段，并且将字段值设为命令中的增减值而 <code>$mul</code> 会创建字段，但是把字段值设为 0。</p><p><strong>$min</strong> 和 <strong>$max</strong></p><p>比较之后更新字段值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 实际文档中指定字段值与 &lt;value&gt; 作比较，保留较小的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$min</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 类似的，实际文档中指定字段值与 &lt;value&gt; 作比较，保留较大的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$max</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>时间相关</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$min</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment"># 原值 ISODate(&quot;2050-02-01T22:00:00Z&quot;)，新值更早，所以会更新文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field1&gt;.&lt;field2&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ISODate</span><span class="token punctuation">(</span><span class="token string">&quot;2020-02-01T22:00:00Z&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>如果被更新的字段不存在，本来不存在的字段值会自动创建并设置为对应字段值。</p><p>如果被更新的字段类型和更新值类型不一致，<code>$min</code> 和 <code>$max</code> 命令会按照 BSON 数据类型排序规则进行比较。</p><ol><li>Null</li><li>Numbers（ints、longs、doubles、decimals）</li><li>Symbol、String</li><li>Object</li><li>Array</li><li>BinData</li><li>ObjectId</li><li>Boolean</li><li>Date</li><li>Timestamp</li><li>Regular Expression</li></ol><h4 id="数组更新操作符"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#数组更新操作符"><span class="icon icon-link"></span></a>数组更新操作符</h4><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th>操作符</th><th>说明</th></tr></thead><tbody><tr><td><code>$addToSet</code></td><td>向数组中增添元素</td></tr><tr><td><code>$pop</code></td><td>从数组中移除元素</td></tr><tr><td><code>$pull</code></td><td>从数组中选择性地一处元素</td></tr><tr><td><code>$pullAll</code></td><td>从数组中有选择性地移除元素</td></tr><tr><td><code>$push</code></td><td>想数组中增添元素</td></tr></tbody></table></div></div><h5 id="addtoset"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#addtoset"><span class="icon icon-link"></span></a>$addToSet</h5><p>向数组中增添元素</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看 Karen 的账户文档中添加联系方式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 插入对象</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>如果要插入的值已经存在数组字段中时，则 <code>$addToSet</code> 不会再添加重复值。</p><p>⚠️ <strong>注意：<strong>使用 <code>$addToSet</code> 插入数组和文档时，插入值中的</strong>字段顺序</strong>也和已有值重复的时候，才被算作重复值被忽略</p><p>向数组添加多个元素：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 会将数组插入被更新的数组字段中，成为内嵌数组</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h5 id="each"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#each"><span class="icon icon-link"></span></a>$each</h5><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 将多个成员的数组合并到数组字段中，而不是作为一个成员合并到数组字段中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token variable">$each</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">valueN</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h5 id="pop"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#pop"><span class="icon icon-link"></span></a>$pop</h5><p>从数组字段中删除元素</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 将查询所得文档的 &lt;field&gt; 数组字段中删除最后一个值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$pop</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 将查询所得文档的 &lt;field&gt; 内嵌数组字段中删除第一个元素</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$pop</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;&lt;field&gt;.&lt;index&gt;&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> -1</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>删除掉数组中最后一个元素后，会留下空数组</p><p>⚠️ 注意：<code>$pop</code> 操作符只能用于数组类型字段</p><h5 id="pull"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#pull"><span class="icon icon-link"></span></a>$pull</h5><p>从数组字段中删除特定元素</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 删除查询所得文档中，数组字段 &lt;field&gt; 中包含符合 &lt;pattern&gt; 正则的成员的值</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$pull</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token variable">$regex</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">pattern</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><p>如果要删除的元素是一个数组，数组元素的值和排列顺序都必须和被删除的数组完全一样。元素的数量、元素的值都需要完全一样。</p><h5 id="push"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#push"><span class="icon icon-link"></span></a>$push</h5><p>向数组字段中添加元素</p><p>和 <code>$addToSet</code> 命令一样，如果 <code>$push</code> 命令中指定的数组字段不存在，这个字段会被添加到原文档中。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 将 &lt;value&gt; 添加到数组字段 &lt;field&gt; 的成员中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token variable">$push</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span></div></pre></div><h5 id="pullall"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#pullall"><span class="icon icon-link"></span></a>$pullAll</h5><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 移除文档中数组字段 &lt;field&gt; 值为 &lt;value1&gt; 和 &lt;value2&gt; 的数组成员</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.survey.update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">1</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$pullAll</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token punctuation">..</span><span class="token plain">., </span><span class="token operator">&lt;</span><span class="token plain">valueN</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h3 id="删除文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#删除文档"><span class="icon icon-link"></span></a>删除文档</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 删除所有文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除符合条件的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">comparasion-operators</span><span class="token operator">&gt;</span><span class="token plain">: </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><p>在默认情况下，<code>remove</code> 命令会删除所有符合筛选条件的文档。</p><p>如果只想删除满足筛选条件的第一篇文档，可以使用 <code>justOne</code> 选项。</p><p><a target="_blank" rel="noopener noreferrer" href="https://docs.mongodb.com/manual/reference/method/db.collection.drop/">db.collection.drop()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>删除集合，之前的 <code>remove</code> 命令可以删除集合内的所有文档，但是不会删除集合。</p><p><code>drop</code> 命令可以删除整个集合，包括集合中的所有文档，以及集合的索引。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看数据库集合列表</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ show collections</span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除 &lt;collection&gt; 集合</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 再查看集合列表就没有了</span></div></pre></div><p>如果集合中的文档数量很多，使用 <code>remove</code> 命令删除所有文档的效率不高。</p><p>这种情况下，更加有效率的方法，是使用 <code>drop</code> 命令删除集合，然后再创建空集合并创建索引。</p><h3 id="拷贝文档"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#拷贝文档"><span class="icon icon-link"></span></a>拷贝文档</h3><p>拷贝一个</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 将 &lt;field&gt; 为 &lt;value1&gt; 的文档拷贝为 &lt;value2&gt; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain">.forEach</span><span class="token punctuation">(</span><span class="token plain">function</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  var newDoc </span><span class="token operator">=</span><span class="token plain"> doc</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  newDoc.</span><span class="token operator">&lt;</span><span class="token plain">field</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">value</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  db.</span><span class="token operator">&lt;</span><span class="token plain">collection</span><span class="token operator">&gt;</span><span class="token plain">.insert</span><span class="token punctuation">(</span><span class="token plain">newDoc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span></div></pre></div><h2 id="数据库服务"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#数据库服务"><span class="icon icon-link"></span></a>数据库服务</h2><h2 id="启动数据库"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#启动数据库"><span class="icon icon-link"></span></a>启动数据库</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/mongodb/bin</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">$ </span><span class="token function">sudo</span><span class="token plain"> mongod</span></div></pre></div><p>新建终端：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/mongodb/bin</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 连接成功 MongoDB</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ ./mongo</span></div></pre></div><p>关闭 MongoDB 服务：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ use admin</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">$ db.shutdownserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h2 id="用户管理"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#用户管理"><span class="icon icon-link"></span></a>用户管理</h2><ul><li>db.auth()</li><li>db.changeUserPassword()</li><li>db.createUser()</li><li>db.dropUser()</li><li>db.dropUsers()</li><li>db.getUser()</li><li>db.getUsers()</li><li>db.grantRolesToUser()</li><li>db.removeUser()</li><li>db.revokeRolesFromUser()</li><li>db.updateUser()</li><li>passwordPrompt()</li></ul><h2 id="导入导出"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#导入导出"><span class="icon icon-link"></span></a>导入导出</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 导入</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongoimport</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">mongoimport --host localhost --port </span><span class="token number">27017</span><span class="token plain"> --username ezsonaruser --password </span><span class="token number">123456</span><span class="token plain"> --collection host_locations_test --db ezsonar_25 --file /root/shaql/host_locations.json</span></div></pre></div><p>-- host 后的 localhost：要导入的数据库 ip --port 后的 27017：要导入的实例节点端口号 --username 后的 ezsonaruser：数据库用户名 --password 后的 123456：数据库用户密码 --collection 后的 host_locations_test：要导入的表名 --db 后的 ezsonar_25：要导入的表所在数据库名 --file 后的 /root/shaql/host_locations.json：要导入的源文件路径(默认为当前文件夹)</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># 导出</span></div><div class="token-line"><span class="token plain">mongoexport</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">mongoexport --host localhost --port 27017 --username ezsonaruser --password 123456 --collection host_locations --db ezsonar_25 --out /root/host_locations.json</span></div></pre></div><p>--host 后的 localhost：要导出数据库 ip --port 后的 27017：要导出的实例节点端口号 --username 后的 ezsonaruser：数据库用户名 --password 后的 123456：数据库用户密码 --collection 后的 widgets-test：要导出的表名 --db 后的 ezsonar_25：要导出的表所在数据库名 --out 后的 /root/host_locations.json：要导出的文件路径(默认为当前文件夹)</p><h2 id="备份与恢复"><a aria-hidden="true" tabindex="-1" href="/database-guidebook//mongodb/other/command#备份与恢复"><span class="icon icon-link"></span></a>备份与恢复</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 备份</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongodump -h dbhost -d dbname -o dbdirectory</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 恢复</span></div></pre></div><p>批量导入/导出脚本</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">collections</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token string">&quot;student&quot;</span><span class="token plain">  </span><span class="token string">&quot;teacher&quot;</span><span class="token plain"> </span><span class="token string">&quot;leader&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token for-or-select variable">item</span><span class="token plain"> </span><span class="token keyword">in</span><span class="token plain"> </span><span class="token variable">${collections</span><span class="token variable punctuation">[</span><span class="token variable">@</span><span class="token variable punctuation">]</span><span class="token variable">}</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token keyword">do</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  mongoexport --port </span><span class="token number">27017</span><span class="token plain"> --host localhost -u root -p </span><span class="token number">123456</span><span class="token plain">-c </span><span class="token variable">$item</span><span class="token plain"> -d this_db --type</span><span class="token operator">=</span><span class="token plain">json --out </span><span class="token variable">$item</span><span class="token plain">.json --authenticationDatabase admin</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">done</span></div></pre></div><div class="__dumi-default-table"><div class="__dumi-default-table-content"><table><thead><tr><th>工具</th><th>描述</th></tr></thead><tbody><tr><td>mongosniff</td><td>MongoDB 监测工具，作用类似于 tcpdump</td></tr><tr><td>mongodump</td><td>MongoDB 数据备份工具</td></tr><tr><td>mongoimport</td><td>MongoDB 数据导入工具</td></tr><tr><td>mongoexport</td><td>MongoDB 数据导出工具</td></tr><tr><td>bsondump</td><td>将 bson 格式的文件转储为 JSON 格式的数据</td></tr><tr><td>mongoperf</td><td></td></tr><tr><td>mongorestore</td><td>MongoDB 数据恢复工具</td></tr><tr><td>mongod.exe</td><td>MongoDB 服务启动工具</td></tr><tr><td>mongostat</td><td>Mongodb 自带的状态检测工具</td></tr><tr><td>mongofiles</td><td>GridFS 管理工具，可实现二制文件的存取</td></tr><tr><td>mongooplog</td><td></td></tr><tr><td>mongotop</td><td>跟踪一个 MongoDB 的实例，查看哪些大量的时间花费在读取和写入数据</td></tr><tr><td>mongos</td><td>分片路由，如果使用了 sharding 功能，则应用程序连接的是 mongos 而不是 mongod</td></tr><tr><td>mongo</td><td>客户端命令行工具，其实也是一个 JavaScript 解释器，支持 JavaScript 语法</td></tr></tbody></table></div></div><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.cnblogs.com/mengyu/p/7718311.html">MongoDB 导出 mongoexport 和导入 mongoimport 介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/database-guidebook/edit/master/docs/mongodb/other/command.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">3/31/2024 19:50:54</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/database-guidebook/umi.1fd59c08.js"></script>
  </body>
</html>
